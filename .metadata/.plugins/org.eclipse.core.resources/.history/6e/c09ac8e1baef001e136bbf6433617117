package Controller;

import Model.Data;
import com.opencsv.CSVReader;
import com.opencsv.exceptions.CsvException;

import java.io.FileReader;
import java.io.IOException;
import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.SQLException;
import java.sql.Timestamp;
import java.util.List;

public class CSVUploader {
    private DatabaseController databaseController;

    public CSVUploader(DatabaseController databaseController) {
        this.databaseController = databaseController;
    }

    public void uploadCSV(Data data) throws SQLException, IOException, CsvException {
        Connection connection = databaseController.getConnection();
        CSVReader reader = new CSVReader(new FileReader(data.getFilePath()));
        List<String[]> lines = reader.readAll();

        // Skip the header
        for (int i = 1; i < lines.size(); i++) {
            String[] line = lines.get(i);

            // Prepare the SQL query
            String query = "INSERT INTO Tweets (tweetID, userID, conversationID, createdAt, month, day, year, text, favorites, referenceID, retweets, quotes, replies, isQuoted, isRetweet, isReply, liberal, conservative) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";

            PreparedStatement statement = connection.prepareStatement(query);

            // Set the parameters
            statement.setLong(1, Long.parseLong(line[0]));
            statement.setInt(2, Integer.parseInt(line[1]));
            statement.setLong(3, Long.parseLong(line[2]));
            statement.setTimestamp(4, Timestamp.valueOf(line[3]));
            statement.setInt(5, Integer.parseInt(line[4]));
            statement.setInt(6, Integer.parseInt(line[5]));
            statement.setInt(7, Integer.parseInt(line[6]));
            statement.setString(8, line[7]);
            statement.setInt(9, Integer.parseInt(line[10]));
            statement.setLong(10, Long.parseLong(line[11]));
            statement.setInt(11, Integer.parseInt(line[12]));
            statement.setInt(12, Integer.parseInt(line[13]));
            statement.setInt(13, Integer.parseInt(line[14]));
            statement.setBoolean(14, Boolean.parseBoolean(line[15]));
            statement.setBoolean(15, Boolean.parseBoolean(line[16]));
            statement.setBoolean(16, Boolean.parseBoolean(line[17]));
            statement.setBoolean(17, Boolean.parseBoolean(line[18]));
            statement.setBoolean(18, Boolean.parseBoolean(line[19]));

            // Execute the query
            statement.executeUpdate();
        }

        reader.close();
    }
}